(this["webpackJsonponnx-prototype"]=this["webpackJsonponnx-prototype"]||[]).push([[0],{19:function(e,t,r){},20:function(e,t,r){},35:function(e,t,r){"use strict";r.r(t),t.default=r.p+"static/media/tinyyolov2-7.58217825.onnx"},37:function(e,t,r){"use strict";r.r(t),t.default=r.p+"static/media/sample_720p.a1f8438b.mp4"},38:function(e,t,r){"use strict";r.r(t);var n=r(8),a=r.n(n),o=r(14),i=r.n(o),s=(r(19),r(20),r(1)),u=r.n(s),l=r(4),c=r(2),f=r(3),h=r(6),d=r(0),p=r(7),v=r(11),m=r(13),y=function(){function e(){Object(c.a)(this,e)}return Object(f.a)(e,null,[{key:"calcShape",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.length,o=r.length,i=Math.max(t.length,r.length),s=new Array(i);if(n){if(a<2||o<2)return;var u=e.calcMatMulShape([t[a-2],t[a-1]],[r[o-2],r[o-1]]);if(void 0===u)return;var l=Object(h.a)(u,2);s[i-2]=l[0],s[i-1]=l[1]}for(var c=n?3:1;c<=i;c++){var f=a-c<0?1:t[a-c],d=o-c<0?1:r[o-c];if(f!==d&&f>1&&d>1)return;s[i-c]=Math.max(f,d)}return s}},{key:"calcMatMulShape",value:function(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},{key:"index",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.length-t.length,a=e.slice(n),o=r?a.length-2:a.length,i=0;i<o;i++)a[i]=e[n+i]%t[i];return a}},{key:"calc",value:function(t,r,n){var a=e.calcShape(t.shape,r.shape);if(a){for(var o=b.size(a),i=m(new t.data.constructor(o),a),s=new Array(a.length),u=0;u<o;u++){for(var l=u,c=a.length-1;c>=0;c--)s[c]=l%a[c],l=Math.floor(l/a[c]);var f=e.index(s,t.shape),h=e.index(s,r.shape);i.set.apply(i,Object(v.a)(s.concat(n(t.get.apply(t,Object(v.a)(f)),r.get.apply(r,Object(v.a)(h))))))}return i}}},{key:"isValidBroadcast",value:function(e,t){var r=e.length,n=t.length;if(r>n)return!1;for(var a=1;a<=r;a++)if(1!==e[r-a]&&e[r-a]!==t[n-a])return!1;return!0}}]),e}();function g(e,t,r,n,a){if(n<0||n>=t.length)throw new Error("sourceIndex out of bounds");if(r<0||r>=e.length)throw new Error("targetIndex out of bounds");if(n+a>t.length)throw new Error("source indices to be copied are outside bounds");if(r+a>e.length)throw new Error("target array is too small to hold result");for(var o=0;o<a;o++)e[r+o]=t[n+o]}var w=function(){function e(){Object(c.a)(this,e)}return Object(f.a)(e,null,[{key:"validateSameTypes",value:function(e){if(e.length<2)throw new Error("must contain atleast 2 types to compare equality");for(var t=e[0],r=0;r<e.length;++r)if(e[r]!==t)throw new Error("input types are ")}}]),e}(),b=function(){function e(){Object(c.a)(this,e)}return Object(f.a)(e,null,[{key:"validateEqualDims",value:function(e){if(e.length<2)throw new Error("must contain atleast 2 shapes to compare equality");for(var t=e[0],r=t.length,n=1;n<e.length;++n){var a=e[n];if(a.length!==r)throw new Error("rank is not the same for given inpu shapes");for(var o=0;o<r;++o)if(t[o]!==a[o])throw new Error("input shapes are not the same")}}},{key:"validateDims",value:function(e){if(e.length<0||e.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");if(0===e.length)throw new RangeError("Scaler tensor is not implemented yet");var t,r=Object(p.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(!Number.isInteger(n))throw new TypeError("Invalid shape: ".concat(n," is not an integer"));if(n<=0||n>2147483647)throw new TypeError("Invalid shape: length ".concat(n," is not allowed"))}}catch(a){r.e(a)}finally{r.f()}}},{key:"size",value:function(t){return e.getSizeFromDimensionRange(t,0,t.length)}},{key:"sizeFromDimension",value:function(t,r){if(r>t.length)throw new Error("invalid dimension of ".concat(r," for sizeFromDimension as Tensor has ").concat(t.length," dimensions."));return e.getSizeFromDimensionRange(t,r,t.length)}},{key:"sizeToDimension",value:function(t,r){if(r>t.length)throw new Error("invalid dimension of ".concat(r," for sizeToDimension as Tensor has ").concat(t.length," dimensions."));return e.getSizeFromDimensionRange(t,0,r)}},{key:"getSizeFromDimensionRange",value:function(e,t,r){for(var n=1,a=t;a<r;a++){if(e[a]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");n*=e[a]}return n}},{key:"computeOffset",value:function(e,t,r){void 0===r&&(r=e.length);for(var n=0,a=0;a<r;++a)n+=e[a]*t[a];return n}},{key:"computeStrides",value:function(e){var t=e.length;if(t<2)return[1];var r=new Array(t);r[t-1]=1,r[t-2]=e[t-1];for(var n=t-3;n>=0;--n)r[n]=r[n+1]*e[n+1];return r}},{key:"transpose",value:function(e){return e.reverse()}},{key:"indicesToOffset",value:function(e,t){if(0===t.length)return 0;for(var r=e[e.length-1],n=0;n<e.length-1;++n)r+=t[n]*e[n];return r}},{key:"offsetToIndices",value:function(e,t){var r=t.length;if(0===r)return[];if(1===r)return[e];for(var n=new Array(t.length),a=0;a<n.length-1;++a)n[a]=Math.floor(e/t[a]),e-=n[a]*t[a];return n[n.length-1]=e,n}},{key:"getActualAxisFromNegativeValue",value:function(e,t){if(e<-t&&e>=t-1)throw new Error("unsupported axis for this operation.");return e<0?e+t:e}},{key:"incrementIndex",value:function(e,t,r){void 0===r&&(r=t.length);for(var n=r-1;n>=0&&(e[n]++,!(e[n]<t[n]));--n)e[n]=0}},{key:"calculateReshapedDims",value:function(t,r){for(var n=r.length,a=new Array(n),o=-1,i=1,s=0;s<n;s++){if(r[s]<-1)throw new Error("a dimension cannot be less than -1");if(-1===r[s]){if(-1!==o)throw new Error("at most one dimension can be -1");o=s}else{if(0===r[s]){if(s>=t.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");a[s]=t[s]}else a[s]=r[s];i*=a[s]}}if(-1!==o){var u=e.size(t);if(u%i!==0)throw new Error("the input tensor cannot be reshaped to the requested shape. Input shape: [".concat(t,"] Output shape: [").concat(r,"]"));a[o]=u/i}return a}},{key:"sortBasedOnPerm",value:function(e,t){return t?t.map((function(t){return e[t]})):e.slice().reverse()}},{key:"padShape",value:function(e,t){var r=e.length;return e.map((function(e,n){return e+t[n]+t[n+r]}))}},{key:"areEqual",value:function(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}},{key:"splitDimsIntoTwo",value:function(e,t){for(var r=[],n=[],a=0;a<e.length;++a)a===t?r.push(e[a]):n.push(e[a]);return[r,n]}}]),e}(),x=function(){function e(){Object(c.a)(this,e)}return Object(f.a)(e,null,[{key:"createTypedArray",value:function(e,t){switch(e){case"bool":return new Uint8Array(t);case"int32":return new Int32Array(t);case"float32":return new Float32Array(t);default:throw new Error("Unsupported type")}}}]),e}();var T=r(13);function E(e,t,r,n){"bool"===n&&(e=J(e,"bool"),t=J(t,"bool"));var a=y.calc(T(e.data,e.dims?e.dims.slice(0):[e.data.length]),T(t.data,t.dims?t.dims.slice(0):[t.data.length]),r);if(!a)throw new Error("not broadcastable");var o=n||e.type;return new d.Tensor(o,a.data,a.shape)}function k(e,t){var r=e[0],n=r.dims?r.dims:[r.data.length];if(t>=n.length||t<-1*n.length)throw new Error("axis specified for concat doesn't match input dimensionality");t<0&&(t=n.length+t);for(var a=n[t],o=new Array(n.length),i=1;i<e.length;i++)for(var s=e[i],u=s.dims?s.dims:[s.data.length],l=0;l<n.length;l++){if(l===t&&(a+=u[l]),n[l]!==u[l])throw new Error("non concat dimensions must match");o[l]=u[l]}o[t]=a;for(var c=new d.Tensor(r.type,x.createTypedArray(e[0].type,b.size(o)),o),f=c.data,h=1,p=o.length-1;p>=t;p--)h*=o[p];for(var v=0,m=0;m<e.length;m++){for(var y=e[m],g=y.dims?y.dims:[y.data.length],w=1,T=g.length-1;T>=t;T--)w*=g[T];for(var E=y.data,k=b.size(g),A=v,O=0,j=0;O<k;O++)f[A+O]=E[O],++j===w&&(A+=h-w,j=0);v+=w}return c}function A(e,t){for(var r=e.dims?e.dims:[e.data.length],n=r.length,a=b.getActualAxisFromNegativeValue(t,n),o=b.sizeToDimension(r,a),i=b.sizeFromDimension(r,a),s=e.data,u=x.createTypedArray(e.type,e.data.length),l=0;l<o;l++){for(var c=l*i,f=Number.MIN_VALUE,h=0;h<i;h++)s[c+h]>f&&(f=s[c+h]);for(var p=0,v=0;v<i;v++){var m=s[c+v]-f;u[c+v]=Math.exp(m),p+=Math.exp(m)}for(var y=0;y<i;y++)0===p?u[c+y]=0:u[c+y]/=p}return new d.Tensor(e.type,u,r)}function O(e,t){var r=e.dims?e.dims:[e.data.length],n=r.length,a=new Array(n);if(t&&t.length===n)a=t;else for(var o=0;o<n;o++)a[o]=n-o-1;for(var i=new Array(n),s=new Array(n),u=0;u<n;u++){var l=a[u];i[u]=r[l],s[u]=l+1<n?b.sizeFromDimension(r,l+1):1}for(var c=M(i,e.type),f=e.data,h=c.data,d=0,p=1,v=1,m=!0,y=n-1;y>=0;--y){var w=a[y];m&&w===y?p*=r[w]:(m=!1,v*=r[w],++d)}return 1===v?g(h,f,0,0,p):1===p?function(e,t,r,n,a,o){for(var i=new Array(e).fill(0),s=0,u=0;u<r;++u){var l=b.computeOffset(i,n,e);a[s++]=o[l],b.incrementIndex(i,t,e)}}(d,i,v,s,h,f):function(e,t,r,n,a,o,i){for(var s=new Array(e).fill(0),u=0,l=0,c=0;c<r;++c){g(o,i,l,u+b.computeOffset(s,a,e),n),b.incrementIndex(s,t,e),l+=n}}(d,i,v,p,s,h,f),c}function j(e){return G(e,[e.data.length])}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("float32"!==t&&"int32"!==t)throw new Error("Unsupported type for this transformation");var r=x.createTypedArray(t,1);return r[0]=e,new d.Tensor(t,r,[1])}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("float32"!==t&&"int32"!==t&&"bool"!==t)throw new Error("Unsupported type for creating all zero Tensor");return b.validateDims(e),new d.Tensor(t,x.createTypedArray(t,b.size(e)),e)}function S(e,t,r){if(0===r)throw new Error("Must request atleast one sample");var n=(t-e)/(r-1),a=x.createTypedArray("float32",r);a[0]=e;for(var o=1;o<a.length;o++)a[o]=a[o-1]+n;return new d.Tensor("float32",a,[r])}function I(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===r)throw new Error("Step size of 0 is not acceptable");if(t<r&&1===r&&(r=-1),e===r||e<t&&r<0||t<e&&r>0)return new d.Tensor(n,x.createTypedArray(n,1),[1]);var a=Math.abs(Math.ceil((t-e)/r)),o=x.createTypedArray(n,a);o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return new d.Tensor(n,o,[a])}function _(e){if("float32"!==e.type&&"int32"!==e.type)throw new Error("Unsupported type for transform");return function(e){for(var t=e.data,r=x.createTypedArray(e.type,t.length),n=0;n<t.length;n++)r[n]=1/(1+Math.exp(-t[n]));return new d.Tensor(e.type,r,e.dims?e.dims:[e.data.length])}(e)}function D(e){if("float32"!==e.type&&"int32"!==e.type)throw new Error("Unsupported type for transform");return function(e){if("string"===e.type)throw new Error("Unsupported type for transform");for(var t=e.data,r=x.createTypedArray(e.type,t.length),n=0;n<t.length;n++)r[n]=Math.exp(t[n]);return new d.Tensor(e.type,r,e.dims?e.dims:[e.data.length])}(e)}function F(e,t){if("float32"!==e.type&&"int32"!==e.type||"float32"!==t.type&&"int32"!==t.type)throw new Error("Unsupported type for transform");if(e.type!==t.type)throw new Error("Types are not homogeneous");return E(e,t,(function(e,t){return e+t}),e.type)}function U(e,t){if("float32"!==e.type&&"int32"!==e.type||"float32"!==t.type&&"int32"!==t.type)throw new Error("Unsupported type for transform");if(e.type!==t.type)throw new Error("Types are not homogeneous");return E(e,t,(function(e,t){return e*t}),e.type)}function N(e,t){if("float32"!==e.type&&"int32"!==e.type||"float32"!==t.type&&"int32"!==t.type)throw new Error("Unsupported type for transform");if(e.type!==t.type)throw new Error("Types are not homogeneous");return E(e,t,(function(e,t){return e/t}),e.type)}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e.length<2)throw new Error("Must have atleast 2 tensors to concatenate");if(r){var n=[];e.forEach((function(e){n.push(e.type)})),w.validateSameTypes(n)}return k(e,t)}function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.length<2)throw new Error("Must have atleast 2 tensors to stack");var r=[],n=[];e.forEach((function(e){r.push(e.type),n.push(e.dims?e.dims:[e.data.length])})),w.validateSameTypes(r),b.validateEqualDims(n);var a=e[0].dims?e[0].dims.length:1;t=b.getActualAxisFromNegativeValue(t,a);var o=e.map((function(e){return H(e,t)}));return R(o,t,!1)}function B(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("string"===e.type)throw new Error("Unspported type for this transformation");if("int32"!==t.type||t.dims&&t.dims.length>1)throw new Error("Indices tensor not of specified format");var n=e.dims?e.dims.slice():[e.data.length],a=n,o=t.data;a[r]=o.length;for(var i=b.computeStrides(n),s=b.computeStrides(a),u=x.createTypedArray(e.type,b.size(a)),l=e.data,c=0;c<u.length;++c){var f=b.offsetToIndices(c,s),h=f.slice();h[r]=o[f[r]];var p=b.indicesToOffset(h,i);u[c]=l[p]}return new d.Tensor(e.type,u,a)}function C(e,t,r){if("string"===e.type)throw new Error("Unspported type for this transformation");for(var n=b.computeStrides(r),a=b.computeStrides(e.dims?e.dims:[e.data.length]),o=e.data,i=x.createTypedArray(e.type,b.size(r)),s=0;s<i.length;++s){var u=b.offsetToIndices(s,n).map((function(e,r){return e+t[r]})),l=b.indicesToOffset(u,a);i[s]=o[l]}return new d.Tensor(e.type,i,r)}function V(e,t){if("string"===e.type)throw new Error("Unspported type for this transformation");var r=e.dims?e.dims:[e.data.length],n=r.length,a=new Array(n);if(n!==t.length)throw new Error("Repetitions must be of the same rank as input dims");for(var o=0;o<n;o++)a[o]=r[o]*t[o];for(var i=b.computeStrides(r),s=b.computeStrides(a),u=x.createTypedArray(e.type,b.size(a)),l=e.data,c=0;c<u.length;++c){for(var f=b.offsetToIndices(c,s),h=new Array(n),p=0;p<n;++p)h[p]=f[p]%e.dims[p];var v=b.indicesToOffset(h,i);u[c]=l[v]}return new d.Tensor(e.type,u,a)}function P(e,t){return O(e,t)}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=b.getActualAxisFromNegativeValue(t,e.dims?e.dims.length:1);for(var r=e.dims?e.dims:[e.data.length],n=r.length+1,a=new Array(n),o=0,i=0;i<n;++i)a[i]=i===t?1:r[o++];return new d.Tensor(e.type,e.data,a)}function L(e,t){if("float32"!==e.type&&"int32"!==e.type&&"bool"!==e.type||"float32"!==t.type&&"int32"!==t.type&&"bool"!==t.type)throw new Error("Unsupported type for transform");if(e.type!==t.type)throw new Error("Types are not homogeneous");return E(e,t,(function(e,t){return e>=t?1:0}),"bool")}function W(e,t,r){if(b.areEqual(t.dims?t.dims:[t.data.length],r.dims?r.dims:[r.data.length]),w.validateSameTypes([t.type,r.type]),"bool"!==e.type)throw new Error("Condition tensor must be bool type");var n=t.dims?t.dims:[t.data.length],a=new d.Tensor(t.type,x.createTypedArray(t.type,b.size(n)),n),o=a.data,i=e.data,s=t.data,u=r.data;if(e.dims&&1!==e.dims.length){b.areEqual(e.dims,r.dims?r.dims:[r.data.length]);for(var l=0;l<i.length;++l)o[l]=i[l]>0?s[l]:u[l]}else{var c=e.dims?e.dims:[e.data.length],f=t.dims?t.dims:[t.data.length];if(c[0]!==f[0])throw new Error("Outermost dimensions of input tensors and condition tensor must match");var h=1;if(t.dims&&t.dims.length>1)for(var p=1;p<t.dims.length;++p)h*=t.dims[p];for(var v=0;v<i.length;++v)for(var m=0;m<h;++m)o[v*h+m]=i[v]>0?s[v*h+m]:u[v*h+m]}return a}function J(e,t){switch(t){case"int32":return new d.Tensor("int32",Int32Array.from(e.data),e.dims?e.dims:[e.data.length]);case"float32":return new d.Tensor("float32",Float32Array.from(e.data),e.dims?e.dims:[e.data.length]);case"bool":return new d.Tensor("bool",Uint8Array.from(e.data),e.dims?e.dims:[e.data.length]);default:throw new Error("Unsupported type for casting")}}function G(e,t){return function(e,t){for(var r=b.calculateReshapedDims(e.dims,t),n=new d.Tensor(e.type,x.createTypedArray(e.type,e.data.length),r),a=e.data,o=n.data,i=0;i<e.data.length;++i)o[i]=a[i];return n}(e,t)}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("float32"!==e.type&&"int32"!==e.type)throw new Error("Unsupported type for transform");var r=e.dims?e.dims.length:1;t=b.getActualAxisFromNegativeValue(t,r);for(var n=b.splitDimsIntoTwo(e.dims?e.dims:[e.data.length],t),a=Object(h.a)(n,2),o=a[0],i=a[1],s=e.data,u=x.createTypedArray("int32",0===i.length?1:b.size(i)),l=o[0],c=0;c<u.length;++c){for(var f=l*c,p=s[f],v=0,m=0;m<l;++m){var y=s[f+m];y>p&&(p=y,v=m)}u[c]=v}return new d.Tensor("int32",u,0===i.length?[1]:i)}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("float32"!==e.type&&"int32"!==e.type)throw new Error("Unsupported type for transform");var n=e.dims?e.dims.length:1;t=b.getActualAxisFromNegativeValue(t,n);for(var a=b.splitDimsIntoTwo(e.dims?e.dims:[e.data.length],t),o=Object(h.a)(a,2),i=o[0],s=o[1],u=e.data,l=x.createTypedArray(e.type,0===s.length?1:b.size(s)),c=i[0],f=0;f<l.length;++f){for(var p=c*f,v=u[p],m=0;m<c;++m){var y=u[p+m];y>v&&(v=y)}l[f]=v}var g=[];if(r)for(var w=e.dims?e.dims:[e.data.length],T=0;T<w.length;++T)T===t?g.push(1):g.push(w[T]);else g=s;return new d.Tensor(e.type,l,0===g.length?[1]:g)}var X=["Aeroplane","Bicycle","Bird","Boat","Bottle","Bus","Car","Cat","Chair","Cow","Diningtable","Dog","Horse","Motorbike","Person","Pottedplant","Sheep","Sofa","Train","Tvmonitor"],Y=r(13),Z=r(30),$=r(0),ee=new d.Tensor("float32",[1.08,1.19,3.42,4.41,6.63,11.38,9.42,5.11,16.62,10.52],[5,2]),te=function(){function e(){Object(c.a)(this,e),this.session=void 0;var t=r(35);this.session=$.InferenceSession.create(t.default)}return Object(f.a)(e,[{key:"run",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r,n,a,o,i,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.preprocess(t),n={image:r},e.next=4,this.session;case 4:return a=e.sent,e.next=7,a.run(n);case 7:return o=e.sent,i=new d.Tensor("float32",o.grid.data,[1,125,13,13]),s=O(i,[0,2,3,1]),e.next=12,this.postprocess(s,20);case 12:return l=e.sent,console.log(l),e.abrupt("return",l);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"preprocess",value:function(e){var t=e.data,r=e.width,n=e.height,a=Y(new Float32Array(t),[r,n,4]),o=Y(new Float32Array(r*n*3),[1,3,r,n]);return Z.assign(o.pick(0,0,null,null),a.pick(null,null,0)),Z.assign(o.pick(0,1,null,null),a.pick(null,null,1)),Z.assign(o.pick(0,2,null,null),a.pick(null,null,2)),new d.Tensor("float32",o.data,[1,3,r,n])}},{key:"postprocess",value:function(){var e=Object(l.a)(u.a.mark((function e(t,r){var n,a,o,i,s,l,c,f,p,v,m,y,g,w,b,x,T,E,k,A,O,j,M,S,I,_,D;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.yolo_head(t,ee,20),a=Object(h.a)(n,4),o=a[0],i=a[1],s=a[2],l=a[3],c=this.yolo_boxes_to_corners(o,i),e.next=4,this.yolo_filter_boxes(c,s,l,.01);case 4:if(f=e.sent,p=Object(h.a)(f,3),v=p[0],m=p[1],y=p[2],null!=v){e.next=11;break}return e.abrupt("return",[]);case 11:return g=z(416),w=z(416),b=G(q([w,g,w,g]),[1,4]),x=U(v,b),e.next=17,Promise.all([x.data,m.data]);case 17:return T=e.sent,E=Object(h.a)(T,2),k=E[0],A=E[1],O=this.non_max_suppression(k,A,.4),j=Object(h.a)(O,3),M=j[0],S=j[1],I=j[2],e.next=24,B(y,new d.Tensor("int32",M)).data;case 24:return _=e.sent,D=[],_.forEach((function(e,t){var r=I[t];if(!(r<.3)){var n=X[e],a=Object(h.a)(S[t],4),o=a[0],i=a[1],s=a[2],u=a[3];o=Math.max(0,o),i=Math.max(0,i);var l={className:n,classProb:r,bottom:s=Math.min(416,s),top:o,left:i,right:u=Math.min(416,u)};D.push(l)}})),e.abrupt("return",D);case 28:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"yolo_filter_boxes",value:function(){var e=Object(l.a)(u.a.mark((function e(t,r,n,a){var o,i,s,l,c,f,h,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=U(r,n),i=K(o,-1),s=Q(o,-1),l=j(L(s,z(a))),c=l.size,f=J(S(0,c-1,c),"int32"),h=M([c],"int32"),d=W(l,f,h),e.abrupt("return",[B(G(t,[c,4]),d),B(j(s),d),B(j(i),d)]);case 9:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"yolo_boxes_to_corners",value:function(e,t){var r=new d.Tensor("float32",[2]),n=function(e,t){if("float32"!==e.type&&"int32"!==e.type||"float32"!==t.type&&"int32"!==t.type)throw new Error("Unsupported type for transform");if(e.type!==t.type)throw new Error("Types are not homogeneous");return E(e,t,(function(e,t){return e-t}),e.type)}(e,N(t,r)),a=F(e,N(t,r)),o=[n.dims[0],n.dims[1],n.dims[2],1];return R([C(n,[0,0,0,1],o),C(n,[0,0,0,0],o),C(a,[0,0,0,1],o),C(a,[0,0,0,0],o)],3)}},{key:"non_max_suppression",value:function(e,t,r){for(var n=this,a=[],o=0;o<t.length;o++)a.push([t[o],[e[4*o],e[4*o+1],e[4*o+2],e[4*o+3]],o]);var i=a.sort((function(e,t){return t[0]-e[0]})),s=[];return i.forEach((function(e){for(var t=!0,a=0;a<s.length;a++){if(n.box_iou(e[1],s[a][1])>r){t=!1;break}}t&&s.push(e)})),[s.map((function(e){return e[2]})),s.map((function(e){return e[1]})),s.map((function(e){return e[0]}))]}},{key:"yolo_head",value:function(e,t,r){var n=t.dims[0],a=G(t,[1,1,n,2]),o=e.dims.slice(1,3),i=o[0],s=o[1],u=I(0,o[0]),l=I(0,o[1]);u=V(u,[o[1]]),l=j(P(l=V(H(l,0),[o[0],1])));var c=P(q([u,l]));c=J(c=G(c,[o[0],o[1],1,2]),e.type),e=G(e,[o[0],o[1],n,r+5]);var f=J(G(new d.Tensor("int32",o),[1,1,1,2]),e.type),h=_(C(e,[0,0,0,0],[i,s,n,2])),p=D(C(e,[0,0,0,2],[i,s,n,2])),v=_(C(e,[0,0,0,4],[i,s,n,1])),m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if("float32"!==e.type&&"int32"!==e.type)throw new Error("Unsupported type for transform");return A(e,t)}(C(e,[0,0,0,5],[i,s,n,r]));return[h=N(F(h,c),f),p=N(U(p,a),f),v,m]}},{key:"box_intersection",value:function(e,t){var r=Math.min(e[3],t[3])-Math.max(e[1],t[1]),n=Math.min(e[2],t[2])-Math.max(e[0],t[0]);return r<0||n<0?0:r*n}},{key:"box_union",value:function(e,t){var r=this.box_intersection(e,t);return(e[3]-e[1])*(e[2]-e[0])+(t[3]-t[1])*(t[2]-t[0])-r}},{key:"box_iou",value:function(e,t){return this.box_intersection(e,t)/this.box_union(e,t)}}]),e}(),re=function(){function e(t,r){Object(c.a)(this,e),this.video=void 0,this.canvas=void 0,this.ctx=void 0,this.model=void 0,this.video=t,this.canvas=r,this.canvas.width=416,this.canvas.height=416,this.ctx=this.canvas.getContext("2d"),this.model=new te}return Object(f.a)(e,[{key:"processFrames",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.video.currentTime=0,this.video.onseeked=Object(l.a)(u.a.mark((function e(){var t,n,a,o,i,s,l,c,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.ctx){e.next=2;break}return e.abrupt("return");case 2:return t=r.ctx.canvas.height,n=r.ctx.canvas.width,a=r.video.videoHeight,o=r.video.videoWidth,a>t&&(a*=i=t/a,o*=i),o>n&&(a*=s=n/o,o*=s),l=(n-o)/2,c=(t-a)/2,r.ctx.clearRect(0,0,n,t),r.ctx.drawImage(r.video,l,c,o,a),f=r.ctx.getImageData(0,0,n,t),e.next=15,r.model.run(f);case 15:e.sent.forEach((function(e){null!=r.ctx&&(r.ctx.font="10px Arial",r.ctx.fillStyle="red",r.ctx.fillText(e.className,e.left,e.top+10),r.ctx.beginPath(),r.ctx.lineWidth=4,r.ctx.strokeStyle="red",r.ctx.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.ctx.stroke())}));case 17:case"end":return e.stop()}}),e)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cloneVideo",value:function(){var e=this;this.video.ontimeupdate=function(){var t;null===(t=e.ctx)||void 0===t||t.drawImage(e.video,0,0,e.video.videoWidth,e.video.videoHeight)}}}]),e}(),ne=r(5);var ae=function(){var e=Object(n.useRef)(null),t=Object(n.useRef)(null);Object(n.useEffect)((function(){null!=e.current&&null!=t.current&&new re(e.current,t.current).processFrames(60)}));var a=r(37);return Object(ne.jsx)("div",{className:"App",children:Object(ne.jsxs)("header",{className:"App-header",children:[Object(ne.jsx)("div",{children:Object(ne.jsx)("video",{ref:e,src:a.default,controls:!0})}),Object(ne.jsx)("div",{children:Object(ne.jsx)("canvas",{ref:t,width:"160",height:"96"})})]})})},oe=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,40)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;r(e),n(e),a(e),o(e),i(e)}))};i.a.render(Object(ne.jsx)(a.a.StrictMode,{children:Object(ne.jsx)(ae,{})}),document.getElementById("root")),oe()}},[[38,1,2]]]);
//# sourceMappingURL=main.4fa2c357.chunk.js.map